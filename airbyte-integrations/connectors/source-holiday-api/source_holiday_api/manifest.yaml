version: "0.44.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: ["{{ parameters.extractor_path }}"]

  requester:
    type: HttpRequester
    url_base: "https://holidayapi.com/v1/"
    http_method: "GET"
    authenticator:
      type: NoAuth
    request_parameters:
      key: "{{ config['api_key'] }}"

  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"

  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"

  holidays_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "holidays"
      primary_key: "uuid"
      path: "holidays"
      extractor_path: "holidays"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $ref: "#/definitions/holidays_schema"
    retriever:
      $ref: "#/definitions/retriever"
      requester:
        $ref: "#/definitions/requester"
        request_parameters:
          $ref: "#/definitions/requester/request_parameters"
          country: "{{ config['country'] }}"
          year: "{{ config['year'] }}"

  countries_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "countries"
      path: "countries"
      extractor_path: "countries"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $ref: "#/definitions/countries_schema"
    retriever:
      $ref: "#/definitions/retriever"
      requester:
        $ref: "#/definitions/requester"
        request_parameters:
          $ref: "#/definitions/requester/request_parameters"
          country: "{{ config['country'] }}"
          year: "{{ config['year'] }}"

  languages_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "languages"
      path: "languages"
      extractor_path: "languages"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $ref: "#/definitions/languages_schema"

  holidays_schema:
    $schema: http://json-schema.org/draft-07/schema#
    title: Holidays schema
    additionalProperties: true
    type: object
    properties:
      name:
        type:
          - "null"
          - string
      date:
        type:
          - "null"
          - string
      observed:
        type:
          - "null"
          - string
      public:
        type:
          - "null"
          - boolean
      country:
        type:
          - "null"
          - string
      uuid:
        type:
          - "null"
          - string
      weekday:
        type:
          - "null"
          - object
        properties:
          date:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              numeric:
                type:
                  - "null"
                  - string
          observed:
            type:
              - "null"
              - object
            properties:
              name:
                type:
                  - "null"
                  - string
              numeric:
                type:
                  - "null"
                  - string

  countries_schema:
    $schema: http://json-schema.org/draft-07/schema#
    title: Countries Schema
    type:
      - "null"
      - object
    properties:
      code:
        type:
          - "null"
          - string
      name:
        type:
          - "null"
          - string
      codes:
        type:
          - "null"
          - object
        properties:
          alpha-2:
            type:
              - "null"
              - string
          alpha-3:
            type:
              - "null"
              - string
          numeric:
            type:
              - "null"
              - string
      languages:
        type:
          - "null"
          - array
        items:
          type:
            - "null"
            - string
      currencies:
        type:
          - "null"
          - array
        items:
          type:
            - "null"
            - object
          properties:
            alpha:
              type:
                - "null"
                - string
      flag:
        type:
          - "null"
          - string
      subdivisions:
        type:
          - "null"
          - array
        items:
          type:
            - "null"
            - object
          properties:
            code:
              type:
                - "null"
                - string
            name:
              type:
                - "null"
                - string
            languages:
              type:
                - "null"
                - array
              items:
                type:
                  - "null"
                  - string
      weekend:
        type:
          - "null"
          - array
        items:
          type:
            - "null"
            - object
          properties:
            name:
              type:
                - "null"
                - string
            numeric:
              type:
                - "null"
                - number

  languages_schema:
    $schema: http://json-schema.org/draft-07/schema#
    title: Languages schema
    type:
      - "null"
      - object
    properties:
      code:
        type:
          - "null"
          - string
      name:
        type:
          - "null"
          - string

streams:
  - "#/definitions/holidays_stream"
  - "#/definitions/countries_stream"
  - "#/definitions/languages_stream"

check:
  type: CheckStream
  stream_names:
    - "holidays"
    - "countries"
    - "languages"

spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/holiday-api
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Holiday Api Spec
    type: object
    additionalProperties: true
    required:
      - api_key
    properties:
      api_key:
        title: API Key
        type: string
        description: API Key available at the dashboard, ref - https://holidayapi.com/dashboard
        airbyte-secret: true
      country:
        title: Country
        type: string
        description: Country code to pass as parameter for different streams (ref - https://holidayapi.com/countries)
        default: "US"
      year:
        title: Year
        type: string
        description: Year to pass as parameter for different streams, which is 4 digit year in ISO 8601 format (ref - https://en.wikipedia.org/wiki/ISO_8601#Years).
        default: "2023"
