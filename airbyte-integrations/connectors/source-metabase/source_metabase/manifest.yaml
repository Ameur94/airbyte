version: "0.29.0"

definitions:
  selector:
    extractor:
      field_path: []
  data_field_selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: ["data"]
  requester:
    url_base: "{{ config['instance_api_url'] }}"
    http_method: "GET"
    authenticator:
      type: "LegacySessionTokenAuthenticator"
      username: "{{ config['username'] }}"
      password: "{{ config['password'] }}"
      header: "X-Metabase-Session"
      session_token: "{{ config['session_token'] }}"
      session_token_response_key: "id"
      login_url: "session"
      validate_session_url: "user/current"
  retriever:
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"
  data_field_retriever:
    record_selector:
      $ref: "#/definitions/data_field_selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"
  base_stream:
    primary_key: "id"
    retriever:
      $ref: "#/definitions/retriever"
  cards_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "cards"
      path: "card"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - "null"
          - object
        additionalProperties: true
        properties:
          description:
            description: Description of the card.
            type:
              - "null"
              - string
          archived:
            description: Indicates if the card is archived or not.
            type:
              - "null"
              - boolean
          collection_position:
            description: Position of the card within the collection.
            type:
              - "null"
              - integer
          table_id:
            description: Identifier of the table related to the card.
            type:
              - "null"
              - integer
          result_metadata:
            type:
              - "null"
              - array
            items:
              properties:
                display_name:
                  description: Display name of the result metadata.
                  type:
                    - "null"
                    - string
                field_ref:
                  description: Reference to the field in the result metadata.
                  type:
                    - "null"
                    - string
                    - array
                name:
                  description: Name of the result metadata.
                  type:
                    - "null"
                    - string
                base_type:
                  description: Base data type of the result metadata.
                  type:
                    - "null"
                    - string
                effective_type:
                  description: Effective data type of the result metadata.
                  type:
                    - "null"
                    - string
                semantic_type:
                  description: Semantic type of the result metadata.
                  type:
                    - "null"
                    - string
                fingerprint:
                  description: Fingerprint associated with the result metadata.
                  type:
                    - "null"
                    - object
          creator:
            type:
              - "null"
              - object
            properties:
              email:
                description: Email address of the creator.
                type:
                  - "null"
                  - string
              first_name:
                description: First name of the creator.
                type:
                  - "null"
                  - string
              last_login:
                description: Timestamp of the last login of the creator.
                type:
                  - "null"
                  - string
              is_qbnewb:
                description: Flag indicating if the creator is a newbie in the platform.
                type:
                  - "null"
                  - boolean
              is_superuser:
                description: Flag indicating if the creator is a super user.
                type:
                  - "null"
                  - boolean
              id:
                description: Identifier of the creator.
                type:
                  - "null"
                  - integer
              last_name:
                description: Last name of the creator.
                type:
                  - "null"
                  - string
              date_joined:
                description: Date when the creator joined the platform.
                type:
                  - "null"
                  - string
              common_name:
                description: Common name of the creator of the card.
                type:
                  - "null"
                  - string
          database_id:
            description: Identifier of the database associated with the card.
            type:
              - "null"
              - integer
          enable_embedding:
            description: Flag indicating if embedding is enabled for the card.
            type:
              - "null"
              - boolean
          collection_id:
            description: Identifier of the collection associated with the card.
            type:
              - "null"
              - integer
          query_type:
            description: Type of the query related to the card.
            type:
              - "null"
              - string
          name:
            description: Name of the card.
            type:
              - "null"
              - string
          creator_id:
            description: Identifier of the creator of the card.
            type:
              - "null"
              - integer
          updated_at:
            description: Timestamp indicating the last update time of the card.
            type:
              - "null"
              - string
          made_public_by_id:
            description: Identifier of the user who made the card public.
            type:
              - "null"
              - integer
          embedding_params:
            description: Parameters used for embedding the card.
            type:
              - "null"
              - string
          cache_ttl:
            description:
              Time-to-live (TTL) value for the cached data related to the
              card.
            type:
              - "null"
              - integer
          dataset_query:
            type:
              - "null"
              - object
            properties:
              type:
                description: Type of the dataset query.
                type:
                  - "null"
                  - string
              native:
                type:
                  - "null"
                  - object
                properties:
                  query:
                    description: Query string used in the native format.
                    type:
                      - "null"
                      - string
                  template-tags:
                    description: Template tags used in the query.
                    type:
                      - "null"
                      - object
              database:
                description: Name of the database used in the query.
                type:
                  - "null"
                  - integer
          id:
            description: Unique identifier of the card.
            type:
              - "null"
              - integer
          display:
            description: Display settings for the card.
            type:
              - "null"
              - string
          last-edit-info:
            type:
              - "null"
              - object
            properties:
              id:
                description: Identifier of the last editor.
                type:
                  - "null"
                  - integer
              email:
                description: Email address of the last editor.
                type:
                  - "null"
                  - string
              first_name:
                description: First name of the last editor.
                type:
                  - "null"
                  - string
              last_name:
                description: Last name of the last editor.
                type:
                  - "null"
                  - string
              timestamp:
                description: Timestamp representing the last edit time.
                type:
                  - "null"
                  - string
          visualization_settings:
            description: Settings related to the visualization of the card.
            type:
              - "null"
              - object
          collection:
            type:
              - "null"
              - object
            properties:
              authority_level:
                description: The authority level assigned to the collection.
                type:
                  - "null"
                  - string
              description:
                description: Description of the collection.
                type:
                  - "null"
                  - string
              archived:
                description:
                  Indicates if the collection related to the card is archived
                  or not.
                type:
                  - "null"
                  - boolean
              slug:
                description: Slug representing the collection.
                type:
                  - "null"
                  - string
              color:
                description: Color associated with the collection.
                type:
                  - "null"
                  - string
              name:
                description: Name of the collection.
                type:
                  - "null"
                  - string
              personal_owner_id:
                description: Identifier of the personal owner of the collection.
                type:
                  - "null"
                  - integer
              id:
                description: Unique identifier of the collection.
                type:
                  - "null"
                  - integer
              location:
                description: Location of the collection.
                type:
                  - "null"
                  - string
              namespace:
                description: Namespace to which the collection belongs.
                type:
                  - "null"
                  - string
          dataset:
            description: Dataset related to the card.
            type:
              - "null"
              - boolean
          created_at:
            description: Timestamp indicating the creation time of the card.
            type:
              - "null"
              - string
          public_uuid:
            description: Public UUID associated with the card.
            type:
              - "null"
              - string
  collections_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "collections"
      path: "collection"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - "null"
          - object
        additionalProperties: true
        properties:
          authority_level:
            description: Level of authority assigned to the collection.
            type:
              - "null"
              - string
          description:
            description: Detailed description of the collection.
            type:
              - "null"
              - string
          archived:
            description: Flag indicating if the collection is archived or not.
            type:
              - "null"
              - boolean
          slug:
            description: Slug identifier for the collection.
            type:
              - "null"
              - string
          color:
            description: Color code associated with the collection.
            type:
              - "null"
              - string
          can_write:
            description:
              Flag indicating if the user has write permission for the
              collection.
            type:
              - "null"
              - boolean
          name:
            description: Name of the collection.
            type:
              - "null"
              - string
          personal_owner_id:
            description: Unique identifier of the personal owner of the collection.
            type:
              - "null"
              - integer
          id:
            description: Unique identifier of the collection.
            type:
              - "null"
              - integer
              - string
          location:
            description: Location information of the collection.
            type:
              - "null"
              - string
          namespace:
            description: Namespace to which the collection belongs.
            type:
              - "null"
              - string
  dashboards_stream:
    $ref: "#/definitions/base_stream"
    retriever:
      $ref: "#/definitions/retriever"
      partition_router:
        type: SubstreamPartitionRouter
        parent_stream_configs:
          - type: ParentStreamConfig
            stream: "#/definitions/collections_items_dashboards_stream"
            parent_key: "id"
            partition_field: "id"
    $parameters:
      name: "dashboards"
      path: "/dashboard/{{stream_slice.id}}"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - "null"
          - object
        additionalProperties: true
        properties:
          description:
            description: Brief description or summary of the dashboard.
            type:
              - "null"
              - string
          archived:
            description:
              Indicates if the dashboard is archived. True if archived,
              false if active.
            type:
              - "null"
              - boolean
          collection_position:
            description: Position of the dashboard within the collection.
            type:
              - "null"
              - integer
          enable_embedding:
            description: Flag indicating if embedding is enabled for the dashboard.
            type:
              - "null"
              - boolean
          collection_id:
            description:
              Unique identifier for the collection the dashboard belongs
              to.
            type:
              - "null"
              - integer
          show_in_getting_started:
            description:
              Flag indicating if the dashboard should be shown in the getting
              started section.
            type:
              - "null"
              - boolean
          name:
            description: Name or title of the dashboard.
            type:
              - "null"
              - string
          caveats:
            description: Additional information or warnings related to the dashboard.
            type:
              - "null"
              - string
          creator_id:
            description: Unique identifier of the user who created the dashboard.
            type:
              - "null"
              - integer
          updated_at:
            description: Timestamp indicating when the dashboard was last updated.
            type:
              - "null"
              - string
          made_public_by_id:
            description: Unique identifier of the user who made the dashboard public.
            type:
              - "null"
              - integer
          embedding_params:
            description: Parameters required for embedding the dashboard.
            type:
              - "null"
              - object
          cache_ttl:
            description: Time-to-live (TTL) for caching the dashboard data.
            type:
              - "null"
              - integer
          id:
            description: Unique identifier for the dashboard.
            type:
              - "null"
              - integer
          position:
            description: Position or order of the dashboard when displayed.
            type:
              - "null"
              - string
          last-edit-info:
            description: Information about the user who last edited the dashboard.
            type:
              - "null"
              - object
            properties:
              id:
                description: Unique identifier of the user who last edited the dashboard.
                type:
                  - "null"
                  - integer
              email:
                description: Email address of the user who last edited the dashboard.
                type:
                  - "null"
                  - string
              first_name:
                description: First name of the user who last edited the dashboard.
                type:
                  - "null"
                  - string
              last_name:
                description: Last name of the user who last edited the dashboard.
                type:
                  - "null"
                  - string
              timestamp:
                description: Timestamp when the dashboard was last edited.
                type:
                  - "null"
                  - string
          parameters:
            type:
              - "null"
              - array
            items:
              description: List of parameters associated with the dashboard.
              properties:
                name:
                  description: Name or label of the parameter.
                  type:
                    - "null"
                    - string
                slug:
                  description: Unique identifier for the parameter (short name).
                  type:
                    - "null"
                    - string
                id:
                  description: Unique identifier for the parameter.
                  type:
                    - "null"
                    - string
                type:
                  description: Data type of the parameter.
                  type:
                    - "null"
                    - string
                sectionId:
                  description: Identifier of the section the parameter belongs to.
                  type:
                    - "null"
                    - string
                default:
                  description: Default value for the parameter.
                  type:
                    - "null"
                    - array
                    - string
                  items:
                    type:
                      - "null"
                      - array
                      - boolean
                      - integer
                      - string
          created_at:
            description: Timestamp indicating when the dashboard was created.
            type:
              - "null"
              - string
          public_uuid:
            description: Universally unique identifier (UUID) for the public dashboard.
            type:
              - "null"
              - string
          points_of_interest:
            description: Key points or interests highlighted in the dashboard.
            type:
              - "null"
              - string
          dashcards:
            type:
              - "null"
              - array
            items:
              description: List of dashcards associated with the dashboard.
              type:
                - "null"
                - object
              properties: {}
          param_fields:
            description: Fields for dashboard parameters.
            type:
              - "null"
              - object
            properties: {}
          param_values:
            description: Values assigned to dashboard parameters.
            type:
              - "null"
              - object
            properties: {}
          can_write:
            description:
              Permission level indicating if the user can write to the
              dashboard.
            type:
              - "null"
              - boolean
          tabs:
            type:
              - "null"
              - array
            items:
              description: List of tabs or sections within the dashboard.
              type:
                - "null"
                - object
              properties: {}
          collection_authority_level:
            description:
              Authority level of the collection that the dashboard is part
              of.
            type:
              - "null"
              - string
          collection:
            description: Details of the collection the dashboard belongs to.
            type:
              - "null"
              - object
            properties: {}
  collections_items_dashboards_stream:
    $ref: "#/definitions/base_stream"
    retriever:
      $ref: "#/definitions/data_field_retriever"
      partition_router:
        type: SubstreamPartitionRouter
        parent_stream_configs:
          - type: ParentStreamConfig
            stream: "#/definitions/collections_stream"
            parent_key: "id"
            partition_field: "id"
    $parameters:
      name: "collections_items_dashboards"
      path: "collection/{{stream_slice.id}}/items?models=dashboard"
  databases_stream:
    primary_key: "id"
    retriever:
      $ref: "#/definitions/data_field_retriever"
    $parameters:
      name: "databases"
      path: "database"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - "null"
          - object
        additionalProperties: true
        properties:
          description:
            description: Short description or summary of the database
            type:
              - string
              - "null"
          features:
            type:
              - "null"
              - array
            items:
              description: List of features supported by the database
              type:
                - "null"
                - string
          cache_field_values_schedule:
            description: Schedule for caching field values
            type:
              - "null"
              - string
          timezone:
            description: Timezone configuration for the database
            type:
              - "null"
              - string
          auto_run_queries:
            description: Whether automatic queries should be run on this database
            type:
              - "null"
              - boolean
          metadata_sync_schedule:
            description: Schedule for synchronizing metadata
            type:
              - "null"
              - string
          name:
            description: Name of the database
            type:
              - "null"
              - string
          settings:
            description: Configuration settings for the database
            type:
              - "null"
              - string
          caveats:
            description: Any important warnings or considerations
            type:
              - "null"
              - string
          creator_id:
            description: ID of the user who created the database
            type:
              - "null"
              - integer
          is_full_sync:
            description: Flag indicating if full synchronization is enabled
            type:
              - "null"
              - boolean
          updated_at:
            description: Timestamp of when the database was last updated
            type:
              - "null"
              - string
          native_permissions:
            description: Native permissions associated with the database
            type:
              - "null"
              - string
          cache_ttl:
            description: Time-to-live for cache
            type:
              - "null"
              - integer
          details:
            type:
              - object
              - "null"
            properties:
              project-id:
                description: ID of the project associated with the database
                type:
                  - "null"
                  - string
              service-account-json:
                description: JSON data for service account
                type:
                  - "null"
                  - string
              dataset-filters-type:
                description: Type of filters used for datasets
                type:
                  - "null"
                  - string
              dataset-filters-patterns:
                description: Patterns for filtering datasets
                type:
                  - "null"
                  - string
              cloud-ip-address-info:
                description: Information related to cloud IP addresses
                type:
                  - "null"
                  - string
              advanced-options:
                description: Additional advanced configuration options
                type:
                  - "null"
                  - boolean
              project-id-from-credentials:
                description: Project ID extracted from credentials
                type:
                  - "null"
                  - string
              db:
                description: Type of database being accessed
                type:
                  - "null"
                  - string
              ssl:
                description: Whether to use SSL for connections
                type:
                  - "null"
                  - boolean
              let-user-control-scheduling:
                description: Option to allow user to control scheduling
                type:
                  - "null"
                  - boolean
              use-jvm-timezone:
                description: Option for using JVM timezone
                type:
                  - "null"
                  - boolean
              include-user-id-and-hash:
                description: Whether to include user ID and hash in queries
                type:
                  - "null"
                  - boolean
          is_sample:
            description: Flag indicating if the database is a sample data set
            type:
              - "null"
              - boolean
          id:
            description: Unique identifier for the database
            type:
              - integer
              - "null"
          is_on_demand:
            description: Flag indicating if on-demand sync is enabled
            type:
              - "null"
              - boolean
          options:
            description: Additional configuration options
            type:
              - "null"
              - string
          engine:
            description: Database engine used
            type:
              - "null"
              - string
          initial_sync_status:
            description: Status of initial synchronization
            type:
              - "null"
              - string
          is_audit:
            description: Flag indicating if auditing is enabled
            type:
              - "null"
              - boolean
          dbms_version:
            type:
              - object
              - "null"
            properties:
              flavor:
                description: Type of database management system
                type:
                  - "null"
                  - string
              version:
                description: Specific version of the database management system
                type:
                  - "null"
                  - string
              semantic-version:
                type:
                  - array
                  - "null"
                items:
                  description: Version numbers with semantic meaning
                  type:
                    - integer
                    - "null"
          refingerprint:
            description: Fingerprint for identifying the database
            type:
              - "null"
              - boolean
          created_at:
            description: Timestamp of when the database was created
            type:
              - "null"
              - string
          points_of_interest:
            description: Points of interest related to the database
            type:
              - "null"
              - string
          can_upload:
            description: Flag indicating if uploading is allowed
            type:
              - "null"
              - boolean
  native_query_snippets_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "native_query_snippets"
      path: "native-query-snippet"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - "null"
          - object
        additionalProperties: true
        properties:
          description:
            description: Description of the purpose or usage of the native query snippet
            type:
              - "null"
              - string
          archived:
            description: Indicates if the native query snippet is archived
            type:
              - "null"
              - boolean
          creator:
            description: Information about the user who created the native query snippet
            type:
              - "null"
              - object
            properties:
              email:
                description: User's email address
                type:
                  - "null"
                  - string
              first_name:
                description: User's first name
                type:
                  - "null"
                  - string
              last_login:
                description: Timestamp of the user's last login
                type:
                  - "null"
                  - string
              is_qbnewb:
                description: Indicates if the user is a new user
                type:
                  - "null"
                  - boolean
              is_superuser:
                description: Indicates if the user has superuser privileges
                type:
                  - "null"
                  - boolean
              id:
                description: User's ID
                type:
                  - integer
                  - "null"
              last_name:
                description: User's last name
                type:
                  - "null"
                  - string
              date_joined:
                description: Date when the user joined the platform
                type:
                  - "null"
                  - string
              common_name:
                description: User's common name
                type:
                  - "null"
                  - string
          content:
            description: The actual native query snippet content
            type:
              - "null"
              - string
          collection_id:
            description:
              The ID of the collection to which the native query snippet
              belongs
            type:
              - "null"
              - integer
          name:
            description: The name or title of the native query snippet
            type:
              - "null"
              - string
          creator_id:
            description: The ID of the user who created the native query snippet
            type:
              - "null"
              - integer
          updated_at:
            description:
              Timestamp indicating when the native query snippet was last
              updated
            type:
              - "null"
              - string
          id:
            description: Unique ID of the native query snippet
            type:
              - integer
              - "null"
          entity_id:
            description: The ID of the entity associated with the native query snippet
            type:
              - "null"
              - string
          created_at:
            description: Timestamp indicating when the native query snippet was created
            type:
              - "null"
              - string
  users_stream:
    primary_key: "id"
    retriever:
      $ref: "#/definitions/data_field_retriever"
    $parameters:
      name: "users"
      path: "user"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type:
          - "null"
          - object
        additionalProperties: true
        properties:
          id:
            description: The unique identifier of the user.
            type:
              - "null"
              - integer
          email:
            description: The email address of the user.
            type:
              - "null"
              - string
          first_name:
            description: The first name of the user.
            type:
              - "null"
              - string
          last_name:
            description: The last name of the user.
            type:
              - "null"
              - string
          common_name:
            description: The common name or username of the user.
            type:
              - "null"
              - string
streams:
  - "#/definitions/cards_stream"
  - "#/definitions/collections_stream"
  - "#/definitions/dashboards_stream"
  - "#/definitions/users_stream"
  - "#/definitions/databases_stream"
  - "#/definitions/native_query_snippets_stream"

check:
  stream_names:
    - "dashboards"
