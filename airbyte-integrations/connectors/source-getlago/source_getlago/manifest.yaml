version: "0.29.0"

definitions:
  selector:
    extractor:
      field_path: ["{{ parameters['name'] }}"]
  requester:
    url_base: "{{ config.get('api_url', 'https://api.getlago.com/api/v1') }}"
    http_method: "GET"
    authenticator:
      type: BearerAuthenticator
      api_token: "{{ config['api_key'] }}"
  cursor_paginator:
    type: DefaultPaginator
    page_token_option:
      type: RequestOption
      inject_into: request_parameter
      field_name: "page"
    page_size_option:
      inject_into: request_parameter
      field_name: "per_page"
    pagination_strategy:
      type: "CursorPagination"
      cursor_value: "{{ response.meta.next_page }}"
      stop_condition: "{{ response.meta.next_page is none}}"
      page_size: 100
  retriever:
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      $ref: "#/definitions/cursor_paginator"
    requester:
      $ref: "#/definitions/requester"
  base_stream:
    retriever:
      $ref: "#/definitions/retriever"
  billable_metrics_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "billable_metrics"
      primary_key: "lago_id"
      path: "/billable_metrics"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description:
              The unique identifier (ID) within the Lago system for the
              billable metric.
            type:
              - "null"
              - string
          name:
            description: The name or title of the billable metric.
            type:
              - "null"
              - string
          code:
            description: Unique identifier code associated with the billable metric.
            type:
              - "null"
              - string
          description:
            description: A detailed description of the billable metric.
            type:
              - "null"
              - string
          aggregation_type:
            description:
              The type of aggregation applied to the metric data, e.g.,
              sum, average, count.
            type:
              - "null"
              - string
          created_at:
            description: The timestamp when the billable metric was created.
            type:
              - "null"
              - string
          field_name:
            description: The name of the field associated with the billable metric.
            type:
              - "null"
              - string
          group:
            description:
              The grouping category or classification for the billable
              metric.
            type:
              - "null"
              - object
          active_subscriptions_count:
            description:
              The total count of active subscriptions within the specified
              timeframe.
            type:
              - "null"
              - integer
          draft_invoices_count:
            description:
              The total count of draft invoices related to the billable
              metric.
            type:
              - "null"
              - integer
          plans_count:
            description: The total count of plans associated with the billable metric.
            type:
              - "null"
              - integer
          recurring:
            description: Indicates whether the metric data is recurring or one-time.
            type:
              - "null"
              - boolean
          weighted_interval:
            description: The weighted time interval computation for the metric data.
            type:
              - "null"
              - integer
  plans_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "plans"
      primary_key: "lago_id"
      path: "/plans"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: ID of the plan in the Lago system
            type:
              - "null"
              - string
          name:
            description: Name of the plan
            type:
              - "null"
              - string
          created_at:
            description: Timestamp of plan creation
            type:
              - "null"
              - string
          code:
            description: Code associated with the plan
            type:
              - "null"
              - string
          interval:
            description: Interval at which the plan operates
            type:
              - "null"
              - string
          description:
            description: Description of the plan
            type:
              - "null"
              - string
          amount_cents:
            description: Amount in cents for the plan
            type:
              - "null"
              - integer
          amount_currency:
            description: Currency in which the amount is specified
            type:
              - "null"
              - string
          trial_period:
            description: Duration of the trial period for the plan
            type:
              - "null"
              - number
          pay_in_advance:
            description: Flag indicating if payment is required in advance
            type:
              - "null"
              - boolean
          bill_charges_monthly:
            description: Total bill charges monthly for the plan
            type:
              - "null"
              - boolean
          active_subscriptions_count:
            description: Number of active subscriptions for the plan
            type:
              - "null"
              - integer
          charges:
            description: Array of plan charges data
            items:
              description: Details of each charge within the plan
              additionalProperties: true
              properties:
                billable_metric_code:
                  description: Code for the billable metric
                  type:
                    - "null"
                    - string
                charge_model:
                  description: Model used for charging
                  type:
                    - "null"
                    - string
                created_at:
                  description: Timestamp of creation
                  type:
                    - "null"
                    - string
                group_properties:
                  description: Properties grouped together
                  type:
                    - "null"
                    - array
                invoiceable:
                  description: Flag indicating if charge is invoiceable
                  type:
                    - "null"
                    - boolean
                lago_billable_metric_id:
                  description: ID of the billable metric in Lago system
                  type:
                    - "null"
                    - string
                lago_id:
                  description: ID in the Lago system
                  type:
                    - "null"
                    - string
                min_amount_cents:
                  description: Minimum amount in cents for the charge
                  type:
                    - "null"
                    - integer
                pay_in_advance:
                  description: Flag indicating if payment is made in advance
                  type:
                    - "null"
                    - boolean
                properties:
                  description: Additional properties associated with the charge
                  additionalProperties: true
                  properties:
                    amount:
                      description: Amount for the charge
                      type:
                        - "null"
                        - string
                  type:
                    - "null"
                    - object
                prorated:
                  description: Flag indicating if charge is prorated
                  type:
                    - "null"
                    - boolean
                taxes:
                  description: Taxes applied for the charge
                  type:
                    - "null"
                    - array
              type:
                - "null"
                - object
            type:
              - "null"
              - array
          customers_count:
            description: Number of customers subscribed to the plan
            type:
              - "null"
              - integer
          draft_invoices_count:
            description: Number of draft invoices for the plan
            type:
              - "null"
              - integer
          invoice_display_name:
            description: Display name for invoices related to the plan
            type:
              - "null"
              - string
          parent_id:
            description: ID of the parent plan, if applicable
            type:
              - "null"
              - integer
          taxes:
            description: Taxes applied to the plan
            type:
              - "null"
              - array
  coupons_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "coupons"
      primary_key: "lago_id"
      path: "/coupons"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: The Lago ID associated with the coupon
            type:
              - "null"
              - string
          name:
            description: The name or title of the coupon
            type:
              - "null"
              - string
          code:
            description: The unique identifier for the coupon
            type:
              - "null"
              - string
          coupon_type:
            description: The type of coupon (e.g., percentage-based, fixed amount)
            type:
              - "null"
              - string
          amount_cents:
            description: The monetary amount in cents that the coupon is worth
            type:
              - "null"
              - integer
          amount_currency:
            description: The currency in which the coupon's monetary amount is specified
            type:
              - "null"
              - string
          percentage_rate:
            description:
              The percentage rate at which the coupon applies (if coupon_type
              is percentage-based)
            type:
              - "null"
              - string
          frequency:
            description:
              Frequency at which the coupon can be used (e.g., one-time
              use, reusable)
            type:
              - "null"
              - string
          frequency_duration:
            description: Duration over which the frequency of coupon usage applies
            type:
              - "null"
              - integer
          created_at:
            description: The date and time when the coupon was created
            type:
              - "null"
              - string
          expiration:
            description:
              Boolean value indicating if the coupon has an expiration
              date
            type:
              - "null"
              - string
          expiration_date:
            description: The date when the coupon expires
            type:
              - "null"
              - string
          billable_metric_codes:
            description:
              List of billable metric codes that the coupon is applicable
              to
            type:
              - "null"
              - array
          description:
            description: Description of the coupon and its benefits
            type:
              - "null"
              - string
          expiration_at:
            description: The specific date and time when the coupon expires
            type:
              - "null"
              - string
          limited_billable_metrics:
            description:
              Boolean value indicating if the coupon is limited to specific
              billable metrics
            type:
              - "null"
              - boolean
          limited_plans:
            description:
              Boolean value indicating if the coupon is limited to specific
              plans
            type:
              - "null"
              - boolean
          plan_codes:
            description: List of plan codes that the coupon is applicable to
            type:
              - "null"
              - array
          reusable:
            description:
              Boolean value indicating if the coupon can be reused after
              usage
            type:
              - "null"
              - boolean
          terminated_at:
            description: The date and time when the coupon was terminated (if applicable)
            type:
              - "null"
              - string
  add_ons_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "add_ons"
      primary_key: "lago_id"
      path: "/add_ons"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: The Lago ID associated with the add-on
            type:
              - "null"
              - string
          name:
            description: The name of the add-on
            type:
              - "null"
              - string
          created_at:
            description: The date and time when the add-on was created
            type:
              - "null"
              - string
          invoice_display_name:
            description: The name displayed on the invoice for the add-on
            type:
              - "null"
              - string
          code:
            description: The unique code identifying the add-on
            type:
              - "null"
              - string
          description:
            description: A brief description of the add-on
            type:
              - "null"
              - string
          amount_cents:
            description: The amount in cents for the add-on
            type:
              - "null"
              - integer
          amount_currency:
            description: The currency in which the amount is specified
            type:
              - "null"
              - string
          taxes:
            description: Any taxes associated with the add-on
            type:
              - array
              - "null"
  invoices_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "invoices"
      primary_key: "lago_id"
      path: "/invoices"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: The unique ID assigned to the invoice in the system.
            type:
              - "null"
              - string
          sequential_id:
            description: The sequential ID assigned to the invoice.
            type:
              - "null"
              - integer
          number:
            description: The number of the invoice.
            type:
              - "null"
              - string
          issuing_date:
            description: The date when the invoice was issued.
            type:
              - "null"
              - string
          invoice_type:
            description: The type of the invoice.
            type:
              - "null"
              - string
          status:
            description: The status of the invoice.
            type:
              - "null"
              - string
          amount_cents:
            description: The total amount in cents for the invoice.
            type:
              - "null"
              - integer
          amount_currency:
            description: The currency in which the invoice amount is specified.
            type:
              - "null"
              - string
          vat_amount_cents:
            description: The total VAT amount in cents for the invoice.
            type:
              - "null"
              - integer
          vat_amount_currency:
            description: The currency of the VAT amount.
            type:
              - "null"
              - string
          total_amount_cents:
            description: The total amount in cents of the invoice including all charges.
            type:
              - "null"
              - integer
          total_amount_currency:
            description: The currency of the total invoice amount.
            type:
              - "null"
              - string
          file_url:
            description: The URL of the invoice file.
            type:
              - "null"
              - string
          applied_taxes:
            description: The list of applied taxes to the invoice.
            type:
              - "null"
              - array
          coupons_amount_cents:
            description: The total amount in cents of coupons applied to the invoice.
            type:
              - "null"
              - integer
          credit_amount_cents:
            description: The total amount in cents of credits applied to the invoice.
            type:
              - "null"
              - integer
          credit_amount_currency:
            description: The currency of the credited amount.
            type:
              - "null"
              - string
          credit_notes_amount_cents:
            description:
              The total amount in cents of credit notes applied to the
              invoice.
            type:
              - "null"
              - integer
          currency:
            description: The currency of the invoice.
            type:
              - "null"
              - string
          customer:
            description: Details of the customer associated with the invoice
            additionalProperties: true
            properties:
              address_line1:
                description: The first line of the customer's address.
                type:
                  - "null"
                  - string
              address_line2:
                description: The second line of the customer's address.
                type:
                  - "null"
                  - string
              applicable_timezone:
                description: The timezone applicable to the customer.
                type:
                  - "null"
                  - string
              billing_configuration:
                description: Configuration details related to billing for the customer
                additionalProperties: true
                properties:
                  document_locale:
                    description:
                      The locale for document generation related to the
                      customer.
                    type:
                      - "null"
                      - string
                  invoice_grace_period:
                    description: The grace period allowed for invoice payment.
                    type:
                      - "null"
                      - integer
                  payment_provider:
                    description: The payment provider used by the customer.
                    type:
                      - "null"
                      - string
                  provider_customer_id:
                    description:
                      The unique ID of the customer provided by the payment
                      provider.
                    type:
                      - "null"
                      - integer
                  provider_payment_methods:
                    description:
                      The payment methods accepted by the provider for
                      this customer
                    items:
                      description: The list of payment methods available to the customer.
                      type:
                        - "null"
                        - string
                    type:
                      - "null"
                      - array
                  vat_rate:
                    description: The VAT rate applicable to the customer.
                    type:
                      - "null"
                      - integer
                type: object
              city:
                description: The city of the customer.
                type:
                  - "null"
                  - string
              country:
                description: The country of the customer.
                type:
                  - "null"
                  - string
              created_at:
                description: The timestamp when the customer was created.
                type:
                  - "null"
                  - string
              currency:
                description: The currency associated with the customer.
                type:
                  - "null"
                  - string
              email:
                description: The email address of the customer.
                type:
                  - "null"
                  - string
              external_id:
                description: The external ID linked to the customer.
                type:
                  - "null"
                  - string
              external_salesforce_id:
                description: The Salesforce ID linked to the customer.
                type:
                  - "null"
                  - integer
              lago_id:
                description: The unique ID assigned to the customer in the system.
                type:
                  - "null"
                  - string
              legal_name:
                description: The legal name of the customer.
                type:
                  - "null"
                  - string
              legal_number:
                description: The legal number of the customer.
                type:
                  - "null"
                  - string
              logo_url:
                description: The URL of the customer's logo.
                type:
                  - "null"
                  - string
              metadata:
                description: Additional metadata related to the customer.
                type:
                  - "null"
                  - array
              name:
                description: The name of the customer.
                type:
                  - "null"
                  - string
              net_payment_term:
                description: The payment term for the customer.
                type:
                  - "null"
                  - integer
              phone:
                description: The phone number of the customer.
                type:
                  - "null"
                  - string
              sequential_id:
                description: The sequential ID assigned to the customer.
                type:
                  - "null"
                  - integer
              slug:
                description: The slug assigned to the customer.
                type:
                  - "null"
                  - string
              state:
                description: The state of the customer.
                type:
                  - "null"
                  - string
              tax_identification_number:
                description: The tax identification number of the customer.
                type:
                  - "null"
                  - integer
              timezone:
                description: The timezone of the customer.
                type:
                  - "null"
                  - string
              updated_at:
                description: The timestamp of the last update to the customer.
                type:
                  - "null"
                  - string
              url:
                description: The URL of the customer.
                type: "null"
              zipcode:
                description: The ZIP code of the customer.
                type:
                  - "null"
                  - string
            type: object
          fees_amount_cents:
            description: The total amount in cents of fees applied to the invoice.
            type:
              - "null"
              - integer
          legacy:
            description: Indicates if the invoice is from a legacy system.
            type:
              - "null"
              - boolean
          metadata:
            description: Additional metadata related to the invoice.
            type:
              - "null"
              - array
          net_payment_term:
            description: The net payment term for the invoice.
            type:
              - "null"
              - integer
          payment_due_date:
            description: The due date for payment of the invoice.
            type:
              - "null"
              - string
          payment_status:
            description: The status of payment for the invoice.
            type:
              - "null"
              - string
          prepaid_credit_amount_cents:
            description:
              The total amount in cents of prepaid credits applied to the
              invoice.
            type:
              - "null"
              - integer
          sub_total_excluding_taxes_amount_cents:
            description: The subtotal amount excluding taxes in cents.
            type:
              - "null"
              - integer
          sub_total_including_taxes_amount_cents:
            description: The subtotal amount including taxes in cents.
            type:
              - "null"
              - integer
          sub_total_vat_excluded_amount_cents:
            description: The subtotal amount with VAT excluded in cents.
            type:
              - "null"
              - integer
          sub_total_vat_included_amount_cents:
            description: The subtotal amount with VAT included in cents.
            type:
              - "null"
              - integer
          taxes_amount_cents:
            description: The total amount in cents of taxes applied to the invoice.
            type:
              - "null"
              - integer
          version_number:
            description: The version number of the invoice.
            type:
              - "null"
              - integer
  customers_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "customers"
      primary_key: "lago_id"
      path: "/customers"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: Unique identifier assigned by the Lago system
            type:
              - "null"
              - string
          external_id:
            description: External ID used for reference
            type:
              - "null"
              - string
          name:
            description: The name of the customer
            type:
              - "null"
              - string
          sequential_id:
            description: Sequential ID assigned to the customer
            type:
              - "null"
              - integer
          slug:
            description: Short, human-readable identifier for the customer
            type:
              - "null"
              - string
          vat_rate:
            description: The VAT rate applied to the customer
            type:
              - "null"
              - number
          created_at:
            description: Timestamp indicating when the customer record was created
            type:
              - "null"
              - string
          address_line1:
            description: The first line of the customer's address
            type:
              - "null"
              - string
          address_line2:
            description: The second line of the customer's address
            type:
              - "null"
              - string
          state:
            description: The state or region where the customer is located
            type:
              - "null"
              - string
          email:
            description: The email address of the customer
            type:
              - "null"
              - string
          city:
            description: The city where the customer is located
            type:
              - "null"
              - string
          url:
            description: URL to the customer's webpage or profile
            type:
              - "null"
              - string
          phone:
            description: The phone number of the customer
            type:
              - "null"
              - string
          logo_url:
            description: URL to the customer's logo
            type:
              - "null"
              - string
          legal_name:
            description: The legal name of the customer
            type:
              - "null"
              - string
          legal_number:
            description: The legal number of the customer
            type:
              - "null"
              - string
          currency:
            description: The currency used by the customer
            type:
              - "null"
              - string
          applicable_timezone:
            description: The timezone that is applicable to the customer
            type:
              - "null"
              - string
          billing_configuration:
            description: Billing configuration settings for the customer
            additionalProperties: true
            properties:
              document_locale:
                description: The locale for the billing documents
                type:
                  - "null"
                  - string
              invoice_grace_period:
                description: The grace period for invoice payments
                type:
                  - "null"
                  - integer
              payment_provider:
                description: The payment provider used by the customer
                type:
                  - "null"
                  - string
              provider_customer_id:
                description: ID of the customer in the payment provider's system
                type:
                  - "null"
                  - string
              provider_payment_methods:
                description: List of payment methods accepted by the customer
                items:
                  description: Details of a specific payment method
                  type:
                    - "null"
                    - string
                type:
                  - "null"
                  - array
              vat_rate:
                description: The VAT rate applied to the customer
                type:
                  - "null"
                  - integer
            type: object
          country:
            description: The country where the customer is located
            type:
              - "null"
              - string
          external_salesforce_id:
            description: Salesforce ID associated with the customer
            type:
              - "null"
              - integer
          metadata:
            description: Additional metadata or information related to the customer
            type:
              - "null"
              - array
          net_payment_term:
            description: Net payment term agreed upon with the customer
            type:
              - "null"
              - integer
          tax_identification_number:
            description: Tax identification number of the customer
            type:
              - "null"
              - integer
          taxes:
            description: Taxes applicable to the customer
            type:
              - "null"
              - array
          timezone:
            description: The timezone of the customer's location
            type:
              - "null"
              - string
          updated_at:
            description: Timestamp indicating when the customer record was last updated
            type:
              - "null"
              - string
          zipcode:
            description: The ZIP or postal code of the customer
            type:
              - "null"
              - string
  customer_partition_router:
    type: SubstreamPartitionRouter
    parent_stream_configs:
      - stream: "#/definitions/customers_stream"
        parent_key: external_id
        partition_field: customer_external_id
  subscriptions_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "subscriptions"
      primary_key: "lago_id"
    retriever:
      $ref: "#/definitions/retriever"
      requester:
        $ref: "#/definitions/requester"
        path:
          "/subscriptions?external_customer_id={{ stream_slice.customer_external_id
          }}"
      partition_router:
        $ref: "#/definitions/customer_partition_router"
      record_selector:
        $ref: "#/definitions/selector"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: The ID of the subscription in the Lago system
            type:
              - "null"
              - string
          external_id:
            description: The external ID assigned to the subscription
            type:
              - "null"
              - string
          lago_customer_id:
            description: The customer ID in the Lago system
            type:
              - "null"
              - string
          external_customer_id:
            description: The external customer ID associated with the subscription
            type:
              - "null"
              - string
          name:
            description: The name of the subscription
            type:
              - "null"
              - string
          plan_code:
            description: The current code of the subscribed plan
            type:
              - "null"
              - string
          status:
            description: The current status of the subscription
            type:
              - "null"
              - string
          billing_time:
            description: The time when the subscription billing occurs
            type:
              - "null"
              - string
          subscription_date:
            description: The date when the subscription was created
            type:
              - "null"
              - string
          started_at:
            description: The date and time when the subscription started
            type:
              - "null"
              - string
          terminated_at:
            description: The date and time when the subscription was terminated
            type:
              - "null"
              - string
          canceled_at:
            description: The date and time when the subscription was canceled
            type:
              - "null"
              - string
          created_at:
            description: The date and time when the subscription was created
            type:
              - "null"
              - string
          previous_plan_code:
            description: The code of the plan before the current subscribed plan
            type:
              - "null"
              - string
          next_plan_code:
            description:
              The code of the next plan the subscription will be switched
              to
            type:
              - "null"
              - string
          downgrade_plan_date:
            description: The date when the downgrade of the plan will take effect
            type:
              - "null"
              - string
          ending_at:
            description: The date when the subscription will end
            type:
              - "null"
              - string
          subscription_at:
            description: The date and time when the subscription was activated
            type:
              - "null"
              - string
  wallets_stream:
    $ref: "#/definitions/base_stream"
    $parameters:
      name: "wallets"
      primary_key: "lago_id"
      path: "/wallets"
    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          lago_id:
            description: Unique identifier for the wallet within Lago
            type:
              - "null"
              - string
          lago_customer_id:
            description: Customer ID specific to the Lago platform
            type:
              - "null"
              - string
          external_customer_id:
            description: External customer ID associated with the wallet
            type:
              - "null"
              - string
          status:
            description: Current status of the wallet
            type:
              - "null"
              - string
          currency:
            description: Currency type of the wallet
            type:
              - "null"
              - string
          name:
            description: Name or label assigned to the wallet
            type:
              - "null"
              - string
          rate_amount:
            description: Rate amount associated with the wallet for charging purposes
            type:
              - "null"
              - string
          credits_balance:
            description: Remaining credits balance in the wallet
            type:
              - "null"
              - string
          balance_cents:
            description: The current balance in cents of the wallet
            type:
              - "null"
              - integer
          consumed_credits:
            description: Total credits consumed from the wallet
            type:
              - "null"
              - string
          created_at:
            description: Timestamp indicating when the wallet was created
            type:
              - "null"
              - string
          expiration_at:
            description: Date when the wallet expires or becomes inactive
            type:
              - "null"
              - string
          last_balance_sync_at:
            description: Timestamp of the last balance synchronization
            type:
              - "null"
              - string
          last_consumed_credit_at:
            description: Timestamp of the last credit consumption event
            type:
              - "null"
              - string
          terminated_at:
            description: Timestamp indicating when the wallet was terminated or deactivated
            type:
              - "null"
              - string
  customer_usage_stream:
    name: "customer_usage"
    primary_key: "lago_invoice_id"
    retriever:
      $ref: "#/definitions/retriever"
      requester:
        $ref: "#/definitions/requester"
        path: "/customers/{{stream_slice.customer_external_id}}/current_usage"
      paginator:
        type: NoPagination
      partition_router:
        $ref: "#/definitions/customer_partition_router"

    schema_loader:
      type: InlineSchemaLoader
      schema:
        $schema: http://json-schema.org/draft-07/schema#
        type: object
        additionalProperties: true
        properties:
          from_datetime:
            description: The starting date and time of the billing period.
            type:
              - "null"
              - string
          to_datetime:
            description: The ending date and time of the billing period.
            type:
              - "null"
              - string
          issuing_date:
            description: The date when the invoice was issued.
            type:
              - "null"
              - string
          lago_invoice_id:
            description: The unique ID assigned by Lago for the invoice.
            type:
              - "null"
              - string
          currency:
            description: The currency in which the charges are calculated.
            type:
              - "null"
              - string
          amount_cents:
            description: The total amount in cents charged to the customer.
            type:
              - "null"
              - integer
          taxes_amount_cents:
            description: The total amount in cents for taxes charged.
            type:
              - "null"
              - integer
          total_amount_cents:
            description: The total amount in cents including charges and taxes.
            type:
              - "null"
              - integer
          charges_usage:
            description: Details of individual charges incurred by the customer.
            type:
              - "null"
              - array
            items:
              type:
                - "null"
                - object
              properties:
                units:
                  description: The units used for measurement in the charge.
                  type:
                    - "null"
                    - string
                events_count:
                  description: The total count of events related to the charge.
                  type:
                    - "null"
                    - integer
                amount_cents:
                  description: The amount in cents for a specific charge.
                  type:
                    - "null"
                    - integer
                amount_currency:
                  description: The currency in which the charge is calculated.
                  type:
                    - "null"
                    - string
                charge:
                  description: Details of the charge incurred.
                  type:
                    - "null"
                    - object
                  properties:
                    lago_id:
                      description: The unique ID assigned by Lago for the charge.
                      type:
                        - "null"
                        - string
                    charge_model:
                      description: The model used for charging.
                      type:
                        - "null"
                        - string
                billable_metric:
                  description:
                    Details of the billable metric associated with the
                    charge.
                  type:
                    - "null"
                    - object
                  properties:
                    lago_id:
                      description: The ID assigned by Lago for the billable metric.
                      type:
                        - "null"
                        - string
                    name:
                      description: The name of the billable metric.
                      type:
                        - "null"
                        - string
                    code:
                      description: The unique code assigned to the billable metric.
                      type:
                        - "null"
                        - string
                    aggregation_type:
                      description: The aggregation type used for calculation.
                      type:
                        - "null"
                        - string
                groups:
                  description: Groups associated with the charge details.
                  type:
                    - "null"
                    - array
                  items:
                    type:
                      - "null"
                      - object
                    properties:
                      lago_id:
                        description: The unique ID assigned by Lago for the group.
                        type:
                          - "null"
                          - string
                      key:
                        description: The key associated with the group.
                        type:
                          - "null"
                          - string
                      value:
                        description: The value associated with the group.
                        type:
                          - "null"
                          - string
                      units:
                        description: The units used for measurement in the group.
                        type:
                          - "null"
                          - string
                      events_count:
                        description: The count of events in the group.
                        type:
                          - "null"
                          - integer
                      amount_cents:
                        description: The amount in cents for the group.
                        type:
                          - "null"
                          - integer
streams:
  - "#/definitions/billable_metrics_stream"
  - "#/definitions/plans_stream"
  - "#/definitions/coupons_stream"
  - "#/definitions/add_ons_stream"
  - "#/definitions/invoices_stream"
  - "#/definitions/customers_stream"
  - "#/definitions/subscriptions_stream"
  - "#/definitions/wallets_stream"
  - "#/definitions/customer_usage_stream"

check:
  stream_names:
    - "billable_metrics"
