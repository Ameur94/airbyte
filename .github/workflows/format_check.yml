name: Check for formatting errors
run-name: Check for formatting errors on ${{ github.ref }}
on:
  workflow_dispatch:

  push:
    branches:
      - master
  pull_request:

jobs:
  format-check:
    # IMPORTANT: This name must match the require check name on the branch protection settings
    name: "Check for formatting errors"
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        ref: ${{ github.head_ref }}
        fetch-depth: 1
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install `airbyte-ci` CLI
      # We use the stable `airbyte-ci` from `master`. Ignores any CI changes
      # local to this repo.
      run: >
        pip install
        git+https://github.com/airbytehq/airbyte.git#subdirectory=airbyte-ci/connectors/pipelines

    - name: Run format checks
      run: |
        airbyte-ci format check all
